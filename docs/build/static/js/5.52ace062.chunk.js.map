{"version":3,"sources":["pages/menus/MenuSelect.jsx","pages/roles/EditModal.jsx","pages/roles/index.jsx","../delegated 59 from dll-reference reactVendor_4d7df80752767b89ebdf","../delegated 160 from dll-reference reactVendor_4d7df80752767b89ebdf","../delegated 96 from dll-reference reactVendor_4d7df80752767b89ebdf","pages/roles/style.less"],"names":["index","config","ajax","state","loading","menus","allMenuKeys","expandedRowKeys","columns","title","dataIndex","key","render","value","record","icon","type","width","url","handleSelect","selected","selectedRows","nativeEvent","props","allKeys","childrenKeys","tree","getGenerationKeys","parentKeys","concat","filter","item","includes","reverse","forEach","pk","some","ck","push","onChange","Array","from","Set","handleSelectAll","this","handleSearch","setState","getMenus","then","res","map","id","parentKey","parentId","orderedData","sort","a","b","aOrder","order","bOrder","text","menuTreeData","convertToTree","finally","others","expandable","onExpandedRowsChange","rowSelection","selectedRowKeys","onSelect","onSelectAll","dataSource","pagination","Component","EditModal","modal","isEdit","data","fetchData","get","form","setFieldsValue","handleSubmit","values","successTip","ajaxMethod","put","post","onOk","formProps","labelWidth","okText","cancelText","submit","onCancel","resetFields","ref","onFinish","initialValues","name","label","required","UserCenter","path","deleting","visible","loadingRoleMenu","selectedKeys","selectedRoleId","undefined","items","onClick","e","stopPropagation","color","confirm","onConfirm","handleDelete","params","handleRowClick","del","errorTip","roleId","handleSaveRoleMenu","ids","style","paddingLeft","selectedRoleName","find","layout","htmlType","disabled","span","rowClassName","serialNumber","rowKey","onRow","module","exports","__webpack_require__"],"mappings":"4TAYqBA,EAHpBC,YAAO,CACJC,MAAM,G,+MAQNC,MAAQ,CACJC,SAAS,EACTC,MAAO,GACPC,YAAa,GACbC,gBAAiB,I,EAGrBC,QAAU,CACN,CACIC,MAAO,eAAMC,UAAW,OAAQC,IAAK,OACrCC,OAAQ,SAACC,EAAOC,GAAY,IAChBC,EAASD,EAATC,KAER,OAAIA,EAAa,8BAAM,kBAAC,IAAD,CAAMC,KAAMD,IAAlB,IAA2BF,GAErCA,IAGf,CACIJ,MAAO,eAAMC,UAAW,OAAQC,IAAK,OAAQM,MAAO,GACpDL,OAAQ,SAACC,EAAOC,GAEZ,OADgBA,EAARI,IACQ,2BACF,MAAVL,EAAsB,2BACZ,MAAVA,EAAsB,eAEnB,kB,EAyCnBM,aAAe,SAACL,EAAQM,EAAUC,EAAcC,GAAiB,IAW/C,IAX8C,EACrC,EAAKC,MAApBV,aADoD,MAC5C,GAD4C,EAEpDR,EAAU,EAAKF,MAAfE,MAEAM,EAAQG,EAARH,IAEJa,EAAO,YAAQX,GAGbY,EAAeC,IAAKC,kBAAkBtB,EAAOM,GATS,EAUhCG,EAApBc,kBAVoD,MAUvC,GAVuC,EAWxDR,EAKAI,GAAU,EAHVA,GAAU,EAAAA,GAAQK,OAAR,SAAelB,GAAf,mBAAuBc,MAGfI,OAAR,oBAAkBD,KAG5BJ,EAAUA,EAAQM,QAAO,SAAAC,GAAI,OAAM,CAAGpB,GAAH,mBAAWc,IAAgBO,SAASD,MAGvEH,EAAWK,UAAUC,SAAQ,SAAAC,GACbT,IAAKC,kBAAkBtB,EAAO8B,GACbC,MAAK,SAAAC,GAAE,OAAIb,EAAQQ,SAASK,MAGrDb,EAAQc,KAAKH,GAEbX,EAAUA,EAAQM,QAAO,SAAAC,GAAI,OAAIA,IAASI,SA7BM,IAkCpDI,EAAa,EAAKhB,MAAlBgB,SAERA,GAAYA,EAASC,MAAMC,KAAK,IAAIC,IAAIlB,M,EAG5CmB,gBAAkB,SAACvB,GAAc,IACrBd,EAAgB,EAAKH,MAArBG,YACAiC,EAAa,EAAKhB,MAAlBgB,SAERA,GAAYA,EAASnB,EAAWd,EAAc,K,uDA/ElD,WACIsC,KAAKC,iB,0BAGT,WAAgB,IAAD,OACXD,KAAKE,SAAS,CAAE1C,SAAS,IAGzB2C,cACKC,MAAK,SAAAC,GACF,IAAM5C,EAAQ4C,EAAIC,KAAI,SAAAnB,GAAI,oBAAOpB,IAAKoB,EAAKoB,GAAIC,UAAWrB,EAAKsB,UAAatB,MACtEzB,EAAcD,EAAM6C,KAAI,SAAAnB,GAAI,OAAIA,EAAKpB,OAErC2C,EAAc,YAAKjD,GAAQkD,MAAK,SAACC,EAAGC,GACtC,IAAMC,EAASF,EAAEG,OAAS,EACpBC,EAASH,EAAEE,OAAS,EAG1B,OAAKD,GAAWE,EAITA,EAASF,EAHLF,EAAEK,KAAOJ,EAAEI,KAAO,GAAK,KAMhCC,EAAepC,IAAKqC,cAAcT,GAGlC/C,EAAkBF,EAAM6C,KAAI,SAAAnB,GAAI,OAAIA,EAAKpB,OAC/C,EAAKmC,SAAS,CAAEzC,MAAOyD,EAAcxD,cAAaC,uBAErDyD,SAAQ,kBAAM,EAAKlB,SAAS,CAAE1C,SAAS,S,oBAmDhD,WAAU,IAAD,SAKDwC,KAAKzC,MAHLE,EAFC,EAEDA,MACAD,EAHC,EAGDA,QACAG,EAJC,EAIDA,gBAJC,EAOkCqC,KAAKrB,MAApCV,EAPH,EAOGA,MAAoBoD,GAPvB,EAOU1B,SAPV,qCASL,OACI,kBAAC,IAAD,eACI2B,WAAY,CACR3D,gBAAiBA,EACjB4D,qBAAsB,SAAA5D,GAAe,OAAI,EAAKuC,SAAS,CAAEvC,sBAE7D6D,aAAc,CACVC,gBAAiBxD,EACjByD,SAAU1B,KAAKzB,aACfoD,YAAa3B,KAAKD,iBAEtBvC,QAASA,EACTI,QAASoC,KAAKpC,QACdgE,WAAYnE,EACZoE,YAAY,GACRR,Q,GA/IeS,e,ECAdC,EANpB1E,YAAO,CACJC,MAAM,EACN0E,MAAO,CACHnE,MAAO,SAAAc,GAAK,OAAIA,EAAMsD,OAAS,eAAO,kB,+MAI1C1E,MAAQ,CACJC,SAAS,EACT0E,KAAM,I,EAWVC,UAAY,WACR,IAAI,EAAK5E,MAAMC,QAAf,CADc,IAGP+C,EAAM,EAAK5B,MAAX4B,GAEP,EAAKL,SAAS,CAAC1C,SAAS,IACxB,EAAKmB,MAAMrB,KAAK8E,IAAhB,sBAAmC7B,IAC9BH,MAAK,SAAAC,GACF,EAAKH,SAAS,CAACgC,KAAM7B,GAAO,KAC5B,EAAKgC,KAAKC,eAAejC,MAE5Be,SAAQ,kBAAM,EAAKlB,SAAS,CAAC1C,SAAS,S,EAG/C+E,aAAe,SAACC,GACZ,IAAI,EAAKjF,MAAMC,QAAf,CADuB,IAGhByE,EAAU,EAAKtD,MAAfsD,OACDQ,EAAaR,EAAS,iCAAU,iCAChCS,EAAaT,EAAS,EAAKtD,MAAMrB,KAAKqF,IAAM,EAAKhE,MAAMrB,KAAKsF,KAGlE,EAAK1C,SAAS,CAAC1C,SAAS,IACxBkF,EAHyB,QAGLF,EAAQ,CAACC,eACxBrC,MAAK,WAAO,IACFyC,EAAQ,EAAKlE,MAAbkE,KACPA,GAAQA,OAEXzB,SAAQ,kBAAM,EAAKlB,SAAS,CAAC1C,SAAS,S,uDApC/C,WACqBwC,KAAKrB,MAAfsD,QAGHjC,KAAKmC,c,oBAmCb,WAAU,IAAD,OACEF,EAAUjC,KAAKrB,MAAfsD,OADF,EAEmBjC,KAAKzC,MAAtBC,EAFF,EAEEA,QAAS0E,EAFX,EAEWA,KACVY,EAAY,CACdC,WAAY,KAEhB,OACI,kBAAC,IAAD,CACIvF,QAASA,EACTwF,OAAO,eACPC,WAAW,eACXJ,KAAM,kBAAM,EAAKR,KAAKa,UACtBC,SAAU,kBAAM,EAAKd,KAAKe,gBAE1B,6BACIC,IAAK,SAAAhB,GAAI,OAAI,EAAKA,KAAOA,GACzBiB,SAAUtD,KAAKuC,aACfgB,cAAerB,GAEdD,EAAS,kBAAC,IAAD,iBAAiBa,EAAjB,CAA4B1E,KAAK,SAASoF,KAAK,QAAS,KAClE,kBAAC,IAAD,iBACQV,EADR,CAEIW,MAAM,2BACND,KAAK,OACLE,UAAQ,KAEZ,kBAAC,IAAD,iBACQZ,EADR,CAEIW,MAAM,eACND,KAAK,uB,GA1EU1B,e,aCOlB6B,EAJpBtG,YAAO,CACJuG,KAAM,SACNtG,MAAM,G,+MAGNC,MAAQ,CACJC,SAAS,EACToE,WAAY,GACZiC,UAAU,EACVC,SAAS,EACTvD,GAAI,KACJwD,iBAAiB,EACjBC,aAAc,GACdC,oBAAgBC,G,EAGpBtG,QAAU,CACN,CAAEC,MAAO,2BAAQC,UAAW,OAAQO,MAAO,KAC3C,CAAER,MAAO,eAAMC,UAAW,eAC1B,CACID,MAAO,eAAMC,UAAW,WAAYO,MAAO,IAC3CL,OAAQ,SAACC,EAAOC,GAAY,IAChBqC,EAAarC,EAAbqC,GAAIiD,EAAStF,EAATsF,KACNW,EAAQ,CACV,CACIV,MAAO,eACPW,QAAS,SAACC,GACNA,EAAEC,kBACF,EAAKpE,SAAS,CAAE4D,SAAS,EAAMvD,SAGvC,CACIkD,MAAO,eACPc,MAAO,MACPC,QAAS,CACL3G,MAAM,kCAAD,OAAW2F,EAAX,MACLiB,UAAW,SAACJ,GACRA,EAAEC,kBACF,EAAKI,aAAanE,OAMlC,OAAO,kBAAC,IAAD,CAAU4D,MAAOA,O,EASpC5B,aAAe,SAACC,GACZ,IAAI,EAAKjF,MAAMC,QAAf,CACA,IAAMmH,EAAM,eACLnC,GAIP,EAAKtC,SAAS,CAAE1C,SAAS,IACzB,EAAKmB,MAAMrB,KAAK8E,IAAI,aAAcuC,GAC7BvE,MAAK,SAAAC,GACF,IAAMuB,EAAavB,GAAO,GAE1B,EAAKH,SAAS,CAAE0B,eAGZA,EAAW,IAAI,EAAKgD,eAAehD,EAAW,OAErDR,SAAQ,kBAAM,EAAKlB,SAAS,CAAE1C,SAAS,S,EAGhDkH,aAAe,SAACnE,GACR,EAAKhD,MAAMsG,WAEf,EAAK3D,SAAS,CAAE2D,UAAU,IAC1B,EAAKlF,MAAMrB,KAAKuH,IAAhB,sBAAmCtE,GAAM,KAAM,CAAEkC,WAAY,iCAASqC,SAAU,mCAC3E1E,MAAK,kBAAM,EAAKiC,KAAKa,YACrB9B,SAAQ,kBAAM,EAAKlB,SAAS,CAAE2D,UAAU,S,EAGjDe,eAAiB,SAAC1G,GAAY,IAClBqC,EAAOrC,EAAPqC,GACR,EAAKL,SAAS,CAAE+D,eAAgB1D,EAAIyD,aAAc,KAElD,IAAMW,EAAS,CAAEI,OAAQxE,GACzB,EAAKL,SAAS,CAAE6D,iBAAiB,IACjC,EAAKpF,MAAMrB,KAAK8E,IAAI,oBAAqBuC,GACpCvE,MAAK,SAAAC,GACF,EAAKH,SAAS,CAAE8D,aAAc3D,OAEjCe,SAAQ,kBAAM,EAAKlB,SAAS,CAAE6D,iBAAiB,Q,EAGxDiB,mBAAqB,WAAO,IAGlBL,EAAS,CAAEM,IAFQ,EAAK1H,MAAtByG,cAGR,EAAK9D,SAAS,CAAE1C,SAAS,IACzB,EAAKmB,MAAMrB,KAAKsF,KAAK,oBAAqB+B,EAAQ,CAAElC,WAAY,2DAC3DrC,MAAK,SAAAC,OAGLe,SAAQ,kBAAM,EAAKlB,SAAS,CAAE1C,SAAS,Q,uDAvDhD,WACIwC,KAAKuC,iB,oBAyDT,WAAU,IAAD,WASDvC,KAAKzC,MAPLC,EAFC,EAEDA,QACAoE,EAHC,EAGDA,WACAkC,EAJC,EAIDA,QACAvD,EALC,EAKDA,GACA0D,EANC,EAMDA,eACAD,EAPC,EAODA,aACAD,EARC,EAQDA,gBAIEjB,EAAY,CACdT,KAFarC,KAAKrB,MAAd0D,KAGJhE,MAAO,IACP6G,MAAO,CAAEC,YAAa,KAGpBC,EAAgB,UAAGxD,EAAWyD,MAAK,SAAAlG,GAAI,OAAIA,EAAKoB,KAAO0D,YAAvC,aAAG,EAAqDT,KAE9E,OACI,kBAAC,IAAD,CAAa,UAAU,aAAOhG,QAASA,GAAWuG,GAC9C,kBAAC,IAAD,KACI,6BAAMT,SAAUtD,KAAKuC,aAAcc,IAAK,SAAAhB,GAAI,OAAI,EAAKA,KAAOA,IACxD,kBAAC,IAAD,KACI,kBAAC,IAAD,iBACQS,EADR,CAEIW,MAAM,qBACND,KAAK,UAET,kBAAC,IAAD,CAAa8B,QAAM,GACf,6BAAQlH,KAAK,UAAUmH,SAAS,UAAhC,gBACA,6BAAQnB,QAAS,kBAAM,EAAK/B,KAAKe,gBAAjC,gBACA,6BAAQhF,KAAK,UAAUgG,QAAS,kBAAM,EAAKlE,SAAS,CAAE4D,SAAS,EAAMvD,GAAI,SAAzE,iBAEJ,yBAAK,UAAU,uBACV6E,EAAmB,iFAAeA,EAAf,UAA2C,sHAC/D,6BAAQI,UAAWJ,EAAkBhH,KAAK,UAAUgG,QAASpE,KAAKgF,oBAAlE,gCAKhB,iCACI,6BAAKS,KAAM,IACP,kBAAC,IAAD,CACIC,aAAc,SAAAxH,GACV,OAAIA,EAAOqC,KAAO0D,EAAuB,sBAElC,cAEX0B,cAAY,EACZ/H,QAASoC,KAAKpC,QACdgE,WAAYA,EACZgE,OAAO,KACPC,MAAO,SAAC3H,EAAQd,GACZ,MAAO,CACHgH,QAAS,kBAAM,EAAKQ,eAAe1G,EAAQd,SAK3D,6BAAKqI,KAAM,IACP,kBAAC,EAAD,CACIxH,MAAO+F,EACPrE,SAAU,SAAAqE,GAAY,OAAI,EAAK9D,SAAS,CAAE8D,sBAItD,kBAAC,EAAD,CACIF,QAASA,EACTvD,GAAIA,EACJ0B,OAAe,OAAP1B,EACRsC,KAAM,kBAAM,EAAK3C,SAAS,CAAE4D,SAAS,GAAS,EAAKzB,KAAKa,SACxDC,SAAU,kBAAM,EAAKjD,SAAS,CAAE4D,SAAS,Y,GAhLrBhC,e,uBCnBxCgE,EAAOC,QAAWC,EAAoB,EAArB,CAAyB,K,0CCA1CF,EAAOC,QAAWC,EAAoB,EAArB,CAAyB,M,oBCA1CF,EAAOC,QAAWC,EAAoB,EAArB,CAAyB,K,oBCC1CF,EAAOC,QAAU,CAAC,KAAO,aAAa,gBAAgB","file":"static/js/5.52ace062.chunk.js","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Icon } from 'ra-lib';\nimport config from 'src/commons/config-hoc';\nimport { tree } from 'ra-lib';\nimport { Table } from 'ra-lib';\nimport getMenus from 'src/menus';\nimport './style.less';\n\n@config({\n    ajax: true,\n})\nexport default class index extends Component {\n    static propTypes = {\n        value: PropTypes.array,     // 选中的节点\n        onChange: PropTypes.func,   // 选择节点时，触发\n    };\n\n    state = {\n        loading: false,\n        menus: [],\n        allMenuKeys: [],\n        expandedRowKeys: [],\n    };\n\n    columns = [\n        {\n            title: '名称', dataIndex: 'text', key: 'text',\n            render: (value, record) => {\n                const { icon } = record;\n\n                if (icon) return <span><Icon type={icon}/> {value}</span>;\n\n                return value;\n            },\n        },\n        {\n            title: '类型', dataIndex: 'type', key: 'type', width: 80,\n            render: (value, record) => {\n                const { url } = record;\n                if (url) return '站外菜单';\n                if (value === '1') return '站内菜单';\n                if (value === '2') return '功能';\n\n                return '菜单';\n            },\n        },\n    ];\n\n    componentDidMount() {\n        this.handleSearch();\n    }\n\n    handleSearch() {\n        this.setState({ loading: true });\n        // this.props.ajax\n        //     .get('/menus')\n        getMenus()\n            .then(res => {\n                const menus = res.map(item => ({ key: item.id, parentKey: item.parentId, ...item }));\n                const allMenuKeys = menus.map(item => item.key);\n                // 菜单根据order 排序\n                const orderedData = [ ...menus ].sort((a, b) => {\n                    const aOrder = a.order || 0;\n                    const bOrder = b.order || 0;\n\n                    // 如果order都不存在，根据 text 排序\n                    if (!aOrder && !bOrder) {\n                        return a.text > b.text ? 1 : -1;\n                    }\n\n                    return bOrder - aOrder;\n                });\n\n                const menuTreeData = tree.convertToTree(orderedData);\n\n                // 默认展开全部\n                const expandedRowKeys = menus.map(item => item.key);\n                this.setState({ menus: menuTreeData, allMenuKeys, expandedRowKeys });\n            })\n            .finally(() => this.setState({ loading: false }));\n\n    }\n\n\n    handleSelect = (record, selected, selectedRows, nativeEvent) => {\n        const { value = [] } = this.props;\n        const { menus } = this.state;\n\n        const { key } = record;\n\n        let allKeys = [ ...value ];\n\n        // 全选 取消 子级\n        const childrenKeys = tree.getGenerationKeys(menus, key);\n        const { parentKeys = [] } = record;\n        if (selected) {\n            // 子级全部加入\n            allKeys = allKeys.concat(key, ...childrenKeys);\n\n            // 父级状态 全部加入\n            allKeys = allKeys.concat(...parentKeys);\n        } else {\n            // 子级全部删除\n            allKeys = allKeys.filter(item => !(([ key, ...childrenKeys ]).includes(item)));\n\n            // 判断父级状态 只要有后代选中就加入\n            parentKeys.reverse().forEach(pk => {\n                const cKs = tree.getGenerationKeys(menus, pk);\n                const hasChildSelected = cKs.some(ck => allKeys.includes(ck));\n\n                if (hasChildSelected) {\n                    allKeys.push(pk);\n                } else {\n                    allKeys = allKeys.filter(item => item !== pk);\n                }\n            });\n        }\n\n        const { onChange } = this.props;\n\n        onChange && onChange(Array.from(new Set(allKeys)));\n    };\n\n    handleSelectAll = (selected) => {\n        const { allMenuKeys } = this.state;\n        const { onChange } = this.props;\n\n        onChange && onChange(selected ? allMenuKeys : []);\n    };\n\n    render() {\n        const {\n            menus,\n            loading,\n            expandedRowKeys,\n        } = this.state;\n\n        const { value, onChange, ...others } = this.props;\n\n        return (\n            <Table\n                expandable={{\n                    expandedRowKeys: expandedRowKeys,\n                    onExpandedRowsChange: expandedRowKeys => this.setState({ expandedRowKeys }),\n                }}\n                rowSelection={{\n                    selectedRowKeys: value,\n                    onSelect: this.handleSelect,\n                    onSelectAll: this.handleSelectAll,\n                }}\n                loading={loading}\n                columns={this.columns}\n                dataSource={menus}\n                pagination={false}\n                {...others}\n            />\n        );\n    }\n}\n\n","import React, {Component} from 'react';\nimport {Form} from 'antd';\nimport {FormElement} from 'ra-lib';\nimport config from 'src/commons/config-hoc';\nimport {ModalContent} from 'ra-lib';\n\n@config({\n    ajax: true,\n    modal: {\n        title: props => props.isEdit ? '修改' : '添加',\n    },\n})\nexport default class EditModal extends Component {\n    state = {\n        loading: false,     // 页面加载loading\n        data: {},           // 回显的角色数据\n    };\n\n    componentDidMount() {\n        const {isEdit} = this.props;\n\n        if (isEdit) {\n            this.fetchData();\n        }\n    }\n\n    fetchData = () => {\n        if (this.state.loading) return;\n\n        const {id} = this.props;\n\n        this.setState({loading: true});\n        this.props.ajax.get(`/mock/roles/${id}`)\n            .then(res => {\n                this.setState({data: res || {}});\n                this.form.setFieldsValue(res);\n            })\n            .finally(() => this.setState({loading: false}));\n    };\n\n    handleSubmit = (values) => {\n        if (this.state.loading) return;\n\n        const {isEdit} = this.props;\n        const successTip = isEdit ? '修改成功！' : '添加成功！';\n        const ajaxMethod = isEdit ? this.props.ajax.put : this.props.ajax.post;\n        const ajaxUrl = isEdit ? '/role' : '/role';\n\n        this.setState({loading: true});\n        ajaxMethod(ajaxUrl, values, {successTip})\n            .then(() => {\n                const {onOk} = this.props;\n                onOk && onOk();\n            })\n            .finally(() => this.setState({loading: false}));\n    };\n\n    render() {\n        const {isEdit} = this.props;\n        const {loading, data} = this.state;\n        const formProps = {\n            labelWidth: 100,\n        };\n        return (\n            <ModalContent\n                loading={loading}\n                okText=\"保存\"\n                cancelText=\"重置\"\n                onOk={() => this.form.submit()}\n                onCancel={() => this.form.resetFields()}\n            >\n                <Form\n                    ref={form => this.form = form}\n                    onFinish={this.handleSubmit}\n                    initialValues={data}\n                >\n                    {isEdit ? <FormElement {...formProps} type=\"hidden\" name=\"id\"/> : null}\n                    <FormElement\n                        {...formProps}\n                        label=\"角色名称\"\n                        name=\"name\"\n                        required\n                    />\n                    <FormElement\n                        {...formProps}\n                        label=\"描述\"\n                        name=\"description\"\n                    />\n                </Form>\n            </ModalContent>\n        );\n    }\n}\n","import React, { Component } from 'react';\nimport { Button, Form, Row, Col } from 'antd';\nimport { PageContent } from 'ra-lib';\nimport config from 'src/commons/config-hoc';\nimport MenuSelect from 'src/pages/menus/MenuSelect';\nimport {\n    QueryBar,\n    FormRow,\n    FormElement,\n    Table,\n    Operator,\n} from 'ra-lib';\nimport EditModal from './EditModal';\nimport './style.less';\n\n@config({\n    path: '/roles',\n    ajax: true,\n})\nexport default class UserCenter extends Component {\n    state = {\n        loading: false,     // 表格加载数据loading\n        dataSource: [],     // 表格数据\n        deleting: false,    // 删除中loading\n        visible: false,     // 添加、修改弹框\n        id: null,           // 需要修改的数据id\n        loadingRoleMenu: false, // 查询角色权限 loading标识\n        selectedKeys: [],   // 角色对应的菜单\n        selectedRoleId: undefined, // 当前选中角色\n    };\n\n    columns = [\n        { title: '角色名称', dataIndex: 'name', width: 150 },\n        { title: '描述', dataIndex: 'description' },\n        {\n            title: '操作', dataIndex: 'operator', width: 100,\n            render: (value, record) => {\n                const { id, name } = record;\n                const items = [\n                    {\n                        label: '修改',\n                        onClick: (e) => {\n                            e.stopPropagation();\n                            this.setState({ visible: true, id });\n                        },\n                    },\n                    {\n                        label: '删除',\n                        color: 'red',\n                        confirm: {\n                            title: `您确定删除\"${name}\"?`,\n                            onConfirm: (e) => {\n                                e.stopPropagation();\n                                this.handleDelete(id);\n                            },\n                        },\n                    },\n                ];\n\n                return <Operator items={items}/>;\n            },\n        },\n    ];\n\n    componentDidMount() {\n        this.handleSubmit();\n    }\n\n    handleSubmit = (values) => {\n        if (this.state.loading) return;\n        const params = {\n            ...values,\n        };\n\n        // 一般系统中，角色不会太多，不做分页查询了\n        this.setState({ loading: true });\n        this.props.ajax.get('/mock/role', params)\n            .then(res => {\n                const dataSource = res || [];\n\n                this.setState({ dataSource });\n\n                // 查询之后，默认选中第一个角色\n                if (dataSource[0]) this.handleRowClick(dataSource[0]);\n            })\n            .finally(() => this.setState({ loading: false }));\n    };\n\n    handleDelete = (id) => {\n        if (this.state.deleting) return;\n\n        this.setState({ deleting: true });\n        this.props.ajax.del(`/mock/roles/${id}`, null, { successTip: '删除成功！', errorTip: '删除失败！' })\n            .then(() => this.form.submit())\n            .finally(() => this.setState({ deleting: false }));\n    };\n\n    handleRowClick = (record) => {\n        const { id } = record;\n        this.setState({ selectedRoleId: id, selectedKeys: [] });\n        // 根据id 获取 role对应的菜单权限\n        const params = { roleId: id };\n        this.setState({ loadingRoleMenu: true });\n        this.props.ajax.get('/mock/roles/menus', params)\n            .then(res => {\n                this.setState({ selectedKeys: res });\n            })\n            .finally(() => this.setState({ loadingRoleMenu: false }));\n    };\n\n    handleSaveRoleMenu = () => {\n        const { selectedKeys } = this.state;\n\n        const params = { ids: selectedKeys };\n        this.setState({ loading: true });\n        this.props.ajax.post('/mock/roles/menus', params, { successTip: '保存角色权限成功！' })\n            .then(res => {\n\n            })\n            .finally(() => this.setState({ loading: false }));\n    };\n\n    render() {\n        const {\n            loading,\n            dataSource,\n            visible,\n            id,\n            selectedRoleId,\n            selectedKeys,\n            loadingRoleMenu,\n        } = this.state;\n\n        const { form } = this.props;\n        const formProps = {\n            form,\n            width: 220,\n            style: { paddingLeft: 16 },\n        };\n\n        const selectedRoleName = dataSource.find(item => item.id === selectedRoleId)?.name;\n\n        return (\n            <PageContent styleName=\"root\" loading={loading || loadingRoleMenu}>\n                <QueryBar>\n                    <Form onFinish={this.handleSubmit} ref={form => this.form = form}>\n                        <FormRow>\n                            <FormElement\n                                {...formProps}\n                                label=\"角色名\"\n                                name=\"name\"\n                            />\n                            <FormElement layout>\n                                <Button type=\"primary\" htmlType=\"submit\">查询</Button>\n                                <Button onClick={() => this.form.resetFields()}>重置</Button>\n                                <Button type=\"primary\" onClick={() => this.setState({ visible: true, id: null })}>添加</Button>\n                            </FormElement>\n                            <div styleName=\"role-menu-tip\">\n                                {selectedRoleName ? <span>当前角色权限：「{selectedRoleName}」</span> : <span>请在左侧列表中选择一个角色！</span>}\n                                <Button disabled={!selectedRoleName} type=\"primary\" onClick={this.handleSaveRoleMenu}>保存权限</Button>\n                            </div>\n                        </FormRow>\n                    </Form>\n                </QueryBar>\n                <Row>\n                    <Col span={14}>\n                        <Table\n                            rowClassName={record => {\n                                if (record.id === selectedRoleId) return 'role-table selected';\n\n                                return 'role-table';\n                            }}\n                            serialNumber\n                            columns={this.columns}\n                            dataSource={dataSource}\n                            rowKey=\"id\"\n                            onRow={(record, index) => {\n                                return {\n                                    onClick: () => this.handleRowClick(record, index),\n                                };\n                            }}\n                        />\n                    </Col>\n                    <Col span={10}>\n                        <MenuSelect\n                            value={selectedKeys}\n                            onChange={selectedKeys => this.setState({ selectedKeys })}\n                        />\n                    </Col>\n                </Row>\n                <EditModal\n                    visible={visible}\n                    id={id}\n                    isEdit={id !== null}\n                    onOk={() => this.setState({ visible: false }, this.form.submit)}\n                    onCancel={() => this.setState({ visible: false })}\n                />\n            </PageContent>\n        );\n    }\n}\n","module.exports = (__webpack_require__(5))(59);","module.exports = (__webpack_require__(5))(160);","module.exports = (__webpack_require__(5))(96);","// extracted by mini-css-extract-plugin\nmodule.exports = {\"root\":\"root-3DN9B\",\"role-menu-tip\":\"role-menu-tip-2g7xJ\"};"],"sourceRoot":""}